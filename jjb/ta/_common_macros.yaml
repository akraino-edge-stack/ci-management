---
#######
# SCM #
#######
- scm:
    # Enhanced version of the global-jjb
    name: ta-lf-infra-gerrit-scm
    scm:
      - git:
          credentials-id: '{jenkins-ssh-credential}'
          url: '{git-url}'
          refspec: '{refspec}'
          branches:
            - 'refs/heads/{branch}'
          skip-tag: true
          wipe-workspace: true
          submodule:
            recursive: '{submodule-recursive}'
            timeout: '{submodule-timeout}'
          choosing-strategy: '{choosing-strategy}'
          basedir: '{basedir}'

###########
# BUILDER #
###########
- builder:
    name: ta-builder-tox
    builders:
        - shell: |2-
            # TODO: enable tox for all projects
            python -m pip install --user --upgrade pip
            python -m pip install --user tox
            for f in $(find $GERRIT_PROJECT -name tox.ini); do
                pushd $(dirname $f)
                #tox
                popd
            done

- builder:
    name: ta-builder-rpm
    builders:
        - shell: |2-
            build-tools/build_rpms.sh \
              -m manifest \
              -r $(dirname $(find . -maxdepth 3 -name 'makebuild.py')) \
              -w work \
              {project-to-build}
            find work/

- builder:
    name: ta-builder-scm
    builders:
        - shell: |2-
            git clone {url}
